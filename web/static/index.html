<!DOCTYPE html>
<html>
<head>
    <title>Zohar Translate</title>
    <meta charset="UTF-8">
    <base href="/static/">

    <link rel="stylesheet" href="style.css">
</head>

<body>

<h1 class="title">Zohar Translate</h1>

<div class="container">
<span class="menu"><span id="copy" class="menu button">Copy Text</span></span>
<span class="menu">
    <span class="microphone" disabled="true">🎙</span>
    <audio class="audio" controls="true" disabled="true"></audio>
</span>

<span class="menu">
    <label for="load"><span class="menu button">Load Text</span></label>
    <input type="file" id="load" />
</span>
</div>

<div class="container">

<span contenteditable="true" class="editable text" id="edited">
</span>

<span class="hebrew text" id="input">
</span>

</div>

<script type="text/javascript" src="dictaphone.js"></script>
<script type="text/javascript">
    const load = document.getElementById("load");
    const copy = document.getElementById("copy");

    const input = document.getElementById("input")
    const edited = document.getElementById("edited")

    function copyText(text) {
        /* Select the text field */
        const elem = document.createElement('textarea');
        elem.value = text;
        document.body.appendChild(elem);
        elem.select();
        document.execCommand('copy');
        document.body.removeChild(elem);
    }

    function send(file) {
        input.innerText = "";
        edited.innerText = "";
        const size = file.size / 1000;
        const seconds = size * 1.8;
        const minutes = seconds / 60;
        if (minutes >= 1)
            alert("Translation will take approximately: " + minutes.toFixed(1) + " minutes.");
        if (minutes < 1)
            alert("Translation will take approximately: " + seconds.toFixed(1) + " seconds.");
        fetch('/', {
            method: 'PUT',
            body: file
        })
        .then(response => (response.ok ? response.json() : {"en": response.statusText, "he": "שגיאה"}))
        .then(texts => {
            if ("en" in texts)
                edited.innerText = texts["en"];
            if ("he" in texts)
                input.innerText = texts["he"];
            edited.focus();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    load.addEventListener('change', (event) => {
        send(load.files[0]);
    });

    copy.addEventListener('click', (event) => {
        const text = document.querySelector('.editable');
        copyText(text.innerText);
    });
</script>
</body>

</html>