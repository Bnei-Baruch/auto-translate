<!DOCTYPE html>
<html>
<head>
    <title>זוהר טרנסלייט</title>
    <meta charset="UTF-8">
    <base href="/static/">

    <link rel="stylesheet" href="style.css">
</head>

<body>

<h1 class="title">זוהר טרנסלייט</h1>

<div id="container">
<span class="menu"><span id="save" class="menu button">שמור טקסט</span></span>
<span class="menu">
    <span class="microphone" disabled="true">🎙</span>
    <audio class="audio" controls="true" disabled="true"></audio>
</span>

<span class="menu">
<label for="load"><span class="menu button">טען טקסט</label>
<input type="file" id="load" />
</span>
</div>

<div id="container">

<span contenteditable="true" class="editable text" id="edited">
</span>

<span class="text" id="output">
</span>

<span class="hebrew text" id="input">
</span>

</div>

<script type="text/javascript" src="dictaphone.js"></script>
<script type="text/javascript">
    const load = document.getElementById("load");
    const save = document.getElementById("save");

    const input = document.getElementById("input")
    const output = document.getElementById("output")
    const edited = document.getElementById("edited")

    function download(text) {
        var filename = prompt('שם הקובץ:');
        if (!filename)
            return;
        if (!filename.endsWith('.txt'))
            filename = filename.concat('.txt');

        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    }

    function send(file) {
        input.innerText = "";
        output.innerText = "";

        fetch('/', {
            method: 'PUT',
            body: file
        })
        .then(response => (response.ok ? response.json() : {"en": response.statusText, "he": "שגיאה"}))
        .then(texts => {
            if ("en" in texts)
                output.innerText = texts["en"];
            if ("he" in texts)
                input.innerText = texts["he"];
            edited.focus();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    load.addEventListener('change', (event) => {
        send(load.files[0]);
    });

    save.addEventListener('click', (event) => {
        const text = document.querySelector('.editable');
        download(text.innerText);
    });
</script>
</body>

</html>
