<!DOCTYPE html>
<html>
<head>
    <title>专 专住</title>
    <meta charset="UTF-8">
    <base href="/static/">

    <link rel="stylesheet" href="style.css">
</head>

<body>

<h1 class="title">专 专住</h1>

<div id="container">
<span class="menu"><span id="save" class="menu button">砖专 拽住</span></span>
<span class="menu">
    <span class="microphone" disabled="true"></span>
    <audio class="audio" controls="true" disabled="true"></audio>
</span>

<span class="menu">
<label for="load"><span class="menu button">注 拽住</label>
<input type="file" id="load" accept=".txt" />
</span>
</div>

<div id="container">

<span contenteditable="true" class="editable text" id="edited">
</span>

<span class="text" id="output">
</span>

<span class="hebrew text" id="input">
</span>

</div>

<script type="text/javascript" src="dictaphone.js"></script>
<script type="text/javascript">
    const load = document.getElementById("load");
    const save = document.getElementById("save");

    const input = document.getElementById("input")
    const output = document.getElementById("output")
    const edited = document.getElementById("edited")

    function download(text) {
        var filename = prompt('砖 拽抓:');
        if (!filename)
            return;
        if (!filename.endsWith('.txt'))
            filename = filename.concat('.txt');

        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    }

    function send(file) {
        input.innerText = "";
        output.innerText = "";

        var reader = new FileReader();

        reader.onload = event => {input.innerText = event.target.result};
        reader.onerror = error => {input.innerText = "砖:  驻砖专转 爪 转 拽专"};
        reader.readAsText(file);

        fetch('/', {
            method: 'PUT',
            body: file
        })
        .then(response => (response.ok ? response.text() : response.statusText))
        .then(text => {
            output.innerText = text;
            edited.focus();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    load.addEventListener('change', (event) => {
        send(load.files[0]);
    });

    save.addEventListener('click', (event) => {
        const text = document.querySelector('.editable');
        download(text.innerText);
    });
</script>
</body>

</html>
